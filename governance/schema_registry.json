{
  "registry_version": 3,
  "description": "Governance-grade schema registry for the Knowledge Ecosystem. Defines required fields, identifier formats, allowed values, workflow transitions, and foreign-key relationships for all canonical datasets.",

  "workflow": {
    "allowed_transitions": {
      "todo": ["in_progress"],
      "in_progress": ["review"],
      "review": ["done"],
      "done": []
    }
  },

  "schemas": {
    "sprints": {
      "schema_version": 1,
      "id_pattern": "^S\\d{2}$",
      "required_fields": [
        "id",
        "name",
        "start_date",
        "end_date",
        "status"
      ],
      "status_values": [
        "planned",
        "active",
        "closed"
      ],
      "notes": "Sprint identifiers follow WBS-style zero-padded numbering."
    },

    "issues": {
      "schema_version": 2,
      "schema_file": "frameworks/schema/issues.schema.json",
      "id_pattern": "^S\\d{2}\\.I\\d{2}$",
      "required_fields": [
        "id",
        "title",
        "sprint",
        "status",
        "created_at",
        "depends_on",
        "mlflow_run_id",
        "status_history"
      ],
      "status_values": [
        "todo",
        "in_progress",
        "review",
        "done"
      ],
      "status_history": {
        "type": "array",
        "description": "Ordered list of status transitions with timestamps",
        "items": {
          "type": "object",
          "required": ["from", "to", "timestamp"],
          "properties": {
            "from": { "type": "string", "enum": ["todo", "in_progress", "review", "done"] },
            "to": { "type": "string", "enum": ["todo", "in_progress", "review", "done"] },
            "timestamp": { "type": "string", "format": "date-time" }
          }
        }
      },
      "foreign_keys": {
        "sprint": "sprints.id"
      },
      "notes": "Issues inherit sprint lineage and must reference an existing sprint. Schema updated in Sprint 04 to unify field names and workflow semantics."
    },

    "tasks": {
      "schema_version": 2,
      "schema_file": "frameworks/schema/tasks.schema.json",
      "id_pattern": "^S\\d{2}\\.I\\d{2}\\.T\\d{2}$",
      "required_fields": [
        "id",
        "issue_id",
        "title",
        "sprint",
        "status",
        "created_at",
        "depends_on",
        "mlflow_run_id",
        "status_history"
      ],
      "status_values": [
        "todo",
        "in_progress",
        "review",
        "done"
      ],
      "status_history": {
        "type": "array",
        "description": "Ordered list of status transitions with timestamps",
        "items": {
          "type": "object",
          "required": ["from", "to", "timestamp"],
          "properties": {
            "from": { "type": "string", "enum": ["todo", "in_progress", "review", "done"] },
            "to": { "type": "string", "enum": ["todo", "in_progress", "review", "done"] },
            "timestamp": { "type": "string", "format": "date-time" }
          }
        }
      },
      "foreign_keys": {
        "issue_id": "issues.id",
        "sprint": "sprints.id"
      },
      "notes": "Tasks inherit both issue and sprint lineage. Schema updated in Sprint 04 to unify field names, add mlflow_run_id, depends_on, and enforce canonical workflow."
    }
  },

  "evolution": [
    {
      "version": 1,
      "changes": "Initial schema definitions for sprints, issues, and tasks. Establishes identifier formats, required fields, status values, and foreign-key relationships."
    },
    {
      "version": 2,
      "changes": "Added global status_transitions and status_history field for issues and tasks to support kanban-style workflow tracking."
    },
    {
      "version": 3,
      "changes": "Sprint 04 schema unification: replaced backlog with todo, unified field names (id, sprint), added mlflow_run_id and depends_on, introduced schema_file references, and aligned status_history with canonical workflow."
    }
  ]
}
